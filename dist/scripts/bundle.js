!function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function o(){y.width=y.clientWidth,y.height=y.width*(9/16);var t=.2*y.width;w.minimap.resize(t,t),w.render(y,f)}function n(t){t.style["margin-left"]="0"}function s(t){t.style["margin-left"]="100%"}function r(t){var e=t;console.log("master volume: "+e),Howler.volume(e),Array.prototype.forEach.call(document.querySelectorAll(".js-master"),function(t){t.value=e})}function a(t,e){var i=e;console.log(t+" volume: "+i),g.setCategoryVolume(t,i),Array.prototype.forEach.call(document.querySelectorAll(".js-"+t),function(t){t.value=i})}function h(){g.doneLoading()&&v.doneLoading()&&(s(x.loading),r(.5),a("shooting",.4),a("other",.6),n(x.main),M=!0),M||window.requestAnimationFrame(h)}console.log("main");var p=(i(3),i(1)),u=i(8),l=i(11),d=i(10),c=(i(6),i(7),i(2)),m=i(4),y=document.querySelector(".js-canv"),f=y.getContext("2d");p.setImageSmoothing(f,!1),y.requestPointerLock=y.requestPointerLock||y.mozRequestPointerLock||y.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var g=new u;g.add("birdDeath",["audio/bird.wav"],"other"),g.add("birdCall",["audio/shriek.wav"],"other"),g.add("hurt",["audio/hit.wav"],"other"),g.add("shoot",["audio/shoot.wav"],"shooting"),g.setupDone=!0;var v=new l;v.load("img/ball.png","ball"),v.load("img/bird.png","bird"),v.load("img/tree1.png","tree1"),v.load("img/tree2.png","tree2"),v.load("img/tree3.png","tree3"),v.load("img/tree4.png","tree4"),v.setupDone=!0;var w=new d;w.audio=g,w.images=v,w.c=y,w.ctx=f,w.requestPointerLock=function(){y.requestPointerLock()},w.exitPointerLock=function(){document.exitPointerLock()},w.loop=function(){w.newTime=(new Date).getTime(),w.dt=w.newTime-w.oldTime,w.gameTime+=w.dt;var t=m.getDirOffsetVector("keyboard");if(0!=t.x||0!=t.y){var e=Math.atan2(t.y,t.x),i=w.player.direction+e;w.player.move(w.player.speed,i,w.dt)}w.enemies.forEach(function(t,e,i){t.moveTowards(w.player.pos,w.enemySpeed,w.dt),t.distance=c.distance(t.pos,w.player.pos),["call","hurt"].forEach(function(e,i,o){if(t.distance<=w[e+"Distance"]){var n=(new Date).getTime()-t[e+"Time"];(void 0==t[e+"Time"]||n>w[e+"Timeout"])&&("call"===e?w.audio.howls.birdCall.play():"hurt"===e&&(w.hits+=1,w.overlayColor.a=.5,w.audio.howls.hurt.play()),t[e+"Time"]=(new Date).getTime())}})});for(var o=0;o<w.shots.length;o++)c.insideRect(w.shots[o].pos,w.origin,w.mapWidth,w.mapHeight)||[w.nonPlayers,w.minimap.entities,w.shots].forEach(function(t,e,i){t.splice(t.indexOf(w.shots[o]),1)});w.shots.forEach(function(t){t.move(w.shootSpeed,t.direction,w.dt)});for(var o=0;o<w.shots.length;o++)for(var s=0;s<w.enemies.length;s++){var r=c.distance(w.shots[o].pos,w.enemies[s].pos);if(r<=w.enemyRadius){[w.nonPlayers,w.minimap.entities].forEach(function(t,e){t.splice(t.indexOf(w.enemies[s]),1),t.splice(t.indexOf(w.shots[o]),1)}),w.enemies.splice(s,1),w.shots.splice(o,1),w.score+=1,w.audio.howls.birdDeath.play();break}}if(w.gameTime-w.spawnTime>w.spawnTimeout){var a=c.randomPointAround(w.player.pos,0,2*Math.PI,w.minSpawnDist,w.maxSpawnDist),h=w.randomEnemyBlipColor();w.addEnemy(a,h),w.spawnTime=w.gameTime}if(w.mouseButtonDown&&w.tryShoot(),c.insideRect(w.player.pos,w.origin,w.mapWidth,w.mapHeight)||w.paused?document.querySelector(".modal-wrapper").style.height="0":document.querySelector(".modal-wrapper").style.height="100%",w.hits>w.hitLimit){w.endGameCleanUp(),document.querySelector(".modal-wrapper").style.height="0",Array.prototype.forEach.call(document.querySelectorAll(".js-score"),function(t){t.innerHTML=w.score});var p="";w.score>w.highScore&&(w.highScore=w.score,p="New "),Array.prototype.forEach.call(document.querySelectorAll(".js-high-score"),function(t){t.innerHTML=w.highScore}),document.querySelector(".js-new").innerHTML=p,n(x.end)}if(w.overlayColor.a>0){var u=w.dt*w.overlayFadeSpeed;u>w.overlayColor.a?w.overlayColor.a=0:w.overlayColor.a-=u}w.render(y,f),w.oldTime=w.newTime,w.looping&&window.requestAnimationFrame(w.loop)},window.addEventListener("resize",o),o();var x={},b=["loading","main","pause","end"];b.forEach(function(t){x[t]=document.querySelector(".js-"+t+"-menu")}),b.forEach(function(t){s(x[t])}),n(x.loading);var M=!1;h(),w.pauseCallback=function(){document.querySelector(".modal-wrapper").style.height="0",Array.prototype.forEach.call(document.querySelectorAll(".js-score"),function(t){t.innerHTML=w.score}),n(x.pause)},w.resumeCallback=function(){s(x.pause)},document.addEventListener("keydown",function(t){var e=m.getKey(t.keyCode);"E"===e&&(w.started&&!w.paused?w.pause():w.started&&w.paused&&w.resume())}),document.querySelector(".js-start").addEventListener("click",function(){s(x.main),w.startGame()}),Array.prototype.forEach.call(document.querySelectorAll(".js-master"),function(t){t.addEventListener("change",function(){var t=parseFloat(this.value);r(t)})}),Array.prototype.forEach.call(document.querySelectorAll(".js-shooting"),function(t){t.addEventListener("change",function(){var t=parseFloat(this.value);a("shooting",t)})}),Array.prototype.forEach.call(document.querySelectorAll(".js-other"),function(t){t.addEventListener("change",function(){var t=parseFloat(this.value);a("other",t)})}),Array.prototype.forEach.call(document.querySelectorAll(".js-mouse-sens"),function(t){t.addEventListener("change",function(){var t=parseFloat(this.value);console.log("Mouse Sensitivity: "+t),m.mouseSens=t,Array.prototype.forEach.call(document.querySelectorAll(".js-mouse-sens"),function(e){e.value=t})})}),document.querySelector(".js-resume").addEventListener("click",function(){s(x.pause),w.resume()}),document.querySelector(".js-pause-return").addEventListener("click",function(){w.endGameCleanUp(),s(x.pause),n(x.main)}),document.querySelector(".js-again").addEventListener("click",function(){s(x.end),w.startGame()}),document.querySelector(".js-end-return").addEventListener("click",function(){s(x.end),n(x.main)})},function(t,e){"use strict";var i={};i.clear=function(t,e){e.save(),e.clearRect(0,0,t.width,t.height),e.restore()},i.drawBorderBox=function(t,e,i,o,n,s,r,a){if(t.save(),t.translate(e,i),r){var h=s/2,p=o-s/2,u=h,l=n-s/2;t.beginPath(),t.moveTo(h,0),t.lineTo(h,l),t.lineTo(p,l),t.lineTo(p,u),t.lineTo(s,u),t.strokeStyle=r,t.lineWidth=s,t.stroke(),t.closePath()}a&&(t.fillStyle=a,t.fillRect(s,s,o-2*s,n-2*s)),t.restore()},i.fillCircle=function(t,e,i,o,n){t.save(),t.translate(e,i),t.beginPath(),t.arc(0,0,o,0,2*Math.PI),t.fillStyle=n,t.fill(),t.closePath(),t.restore()},i.drawPlayerBlip=function(t,e,i,o,n,s,r){t.save(),t.translate(e,i),t.beginPath(),t.arc(0,0,o,0,2*Math.PI);var a=o*Math.cos(s),h=o*Math.sin(s);t.moveTo(a,-h),t.lineTo(2*a,2*-h),t.strokeStyle=r,t.lineWidth=n,t.stroke(),t.closePath(),t.restore()},i.drawViewTri=function(t,e,i,o,n,s){t.save();var r=1/Math.cos(n/2)*s;t.translate(e,i),t.rotate(-o+Math.PI/2),t.beginPath(),t.moveTo(0,0),t.rotate(n/2),t.lineTo(0,-r),t.rotate(-n),t.lineTo(0,-r),t.lineTo(0,0),t.fillStyle="rgba(0, 0, 0, 0.6)",t.fill(),t.closePath(),t.restore()},i.setImageSmoothing=function(t,e){t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e},t.exports=i},function(t,e){"use strict";var i={};i.insideRect=function(t,e,i,o){return t.x>=e.x&&t.x<e.x+i&&t.y>=e.y&&t.y<e.y+o?!0:!1},i.distance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},i.randomPointAround=function(t,e,i,o,n){var s=Math.random()*(i-e)+e,r=Math.random()*(n-o)+o,a=r*Math.cos(s),h=r*Math.sin(s);return{x:t.x+a,y:t.y+h}},t.exports=i},function(t,e){"use strict";var i={};i.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t.exports=i},function(t,e){"use strict";var i={};i.keyDownMap={},i.mouseSens=.01,i.getKey=function(t){var e=String.fromCharCode(t);return e},i.keydown=function(t){var e=i.getKey(t.keyCode);1!=i.keyDownMap[e]&&(i.keyDownMap[e]=!0)},i.isKeyDown=function(t){return i.keyDownMap[t]?!0:!1},i.keyup=function(t){var e=i.getKey(t.keyCode);i.keyDownMap[e]=!1},i.getDirOffsetVector=function(t){var e={x:0,y:0};return"keyboard"===t&&(i.isKeyDown("W")&&(e.x+=1),i.isKeyDown("A")&&(e.y+=1),i.isKeyDown("S")&&(e.x-=1),i.isKeyDown("D")&&(e.y-=1)),e},t.exports=i},function(t,e,i){"use strict";function o(t){this.pos={},this.pos.x=t.x,this.pos.y=t.y,this.blipColor="#000",this.blipRadius="4",this.img=new Image,this.img.src="img/bird.png",this.imgScale=1}var n=i(1);o.prototype.drawBlip=function(t){n.fillCircle(t,0,0,this.blipRadius,this.blipColor)},o.prototype.move=function(t,e,i){var o=Math.cos(e)*t*i,n=Math.sin(e)*t*i*-1;this.pos.x+=o,this.pos.y+=n},o.prototype.moveTowards=function(t,e,i){var o=t.x-this.pos.x,n=t.y-this.pos.y,s=Math.atan2(n,o),r=e*i,a=r*Math.cos(s),h=r*Math.sin(s);Math.abs(a)>Math.abs(o)?this.pos.x=t.x:this.pos.x+=a,Math.abs(h)>Math.abs(n)?this.pos.y=t.y:this.pos.y+=h},t.exports=o},function(t,e,i){"use strict";function o(t,e,i,o,n,s){this.pos={},this.pos.x=t.x,this.pos.y=t.y,this.width=e,this.height=i,this.view={},this.view.pos={},this.view.pos.x=o.x,this.view.pos.y=o.y,this.view.width=n,this.view.height=s,this.borderWidth=4,this.borderColor="#000",this.fillColor="",this.entities=[],this.entitiesAD=[],this.hideEntities=!1}var n=i(2),s=i(1);o.prototype.getInnerWidth=function(){return this.width-2*this.borderWidth},o.prototype.getInnerHeight=function(){return this.height-2*this.borderWidth},o.prototype.resize=function(t,e){this.width=t,this.height=e,this.borderWidth=this.width/50},o.prototype.drawEntityBlip=function(t,e){var i=e.pos.x-this.view.pos.x,o=e.pos.y-this.view.pos.y;t.save(),t.translate(i,o),e.drawBlip(t),t.restore()},o.prototype.draw=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),o=this.getInnerWidth(),r=this.getInnerHeight();e.width=o,e.height=r;var a=o/this.view.width,h=r/this.view.height;i.translate(this.view.pos.x,this.view.pos.y),i.scale(a,h),this.fillColor.length>0&&s.drawBorderBox(t,this.pos.x,this.pos.y,this.width,this.height,this.borderWidth,"",this.fillColor),this.hideEntities||(this.entities.forEach(function(t){n.insideRect(t.pos,this.view.pos,this.view.width,this.view.height)&&this.drawEntityBlip(i,t)}.bind(this)),this.entitiesAD.forEach(function(t){this.drawEntityBlip(i,t)}.bind(this))),t.drawImage(e,this.pos.x+this.borderWidth,this.pos.y+this.borderWidth),s.drawBorderBox(t,this.pos.x,this.pos.y,this.width,this.height,this.borderWidth,this.borderColor,"")},t.exports=o},function(t,e,i){"use strict";function o(t,e){var i=new s(t);return i.direction=e,i.speed=.02,i.fieldOfView=Math.PI/2,i.viewDistance=50,i.drawBlip=function(t){n.drawPlayerBlip(t,0,0,i.blipRadius,i.blipRadius/3,i.direction,i.blipColor),n.drawViewTri(t,0,0,i.direction,i.fieldOfView,i.viewDistance)},i}var n=i(1),s=i(5);t.exports=o},function(t,e){"use strict";function i(){this.howls={},this.categories={},this.setupDone=!1,this.totalNumSounds=0,this.numSoundsLoaded=0}i.prototype.add=function(t,e,i){this.totalNumSounds+=1;var o=new Howl({urls:e,buffer:!0,onload:function(){console.log("sound loaded"),this.numSoundsLoaded+=1}.bind(this),onloaderror:function(){document.querySelector(".js-loading-text").innerHTML="Error loading audio. Your browser may not support .wav files."}});"string"==typeof i&&(void 0===this.categories[i]&&(this.categories[i]=[]),this.categories[i].push(o)),this.howls[t]=o},i.prototype.setCategoryVolume=function(t,e){for(var i=this.categories[t],o=0;o<i.length;o++)i[o].volume(e)},i.prototype.doneLoading=function(){return this.setupDone===!0&&this.numSoundsLoaded===this.totalNumSounds?!0:!1},t.exports=i},function(t,e,i){"use strict";function o(t,e,i,o){this.r=t,this.g=e,this.b=i,this.a=o}var n=i(3);o.random=function(t){var e,i=n.randomInt(0,255),s=n.randomInt(0,255),r=n.randomInt(0,255);return e="number"==typeof t?t:1,new o(i,s,r,e)},o.prototype.toString=function(t){return t?"rgb("+this.r+", "+this.g+", "+this.b+")":"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},o.prototype.floored=function(t){var e=new o(Math.floor(this.r),Math.floor(this.g),Math.floor(this.b),this.a);return t&&(e.a=Math.floor(e.a)),e},o.prototype.inverse=function(t){return t?new o(255-this.r,255-this.g,255-this.b,1-this.a):new o(255-this.r,255-this.g,255-this.b,this.a)},o.prototype.invert=function(t){this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,t&&(this.a=1-this.a)},o.prototype.clamp=function(){["r","g","b"].forEach(function(t,e,i){this[t]=Math.max(Math.min(this[t],255),0)}.bind(this)),this.a=Math.max(Math.min(this.a,1),0)},o.prototype.clone=function(){return new o(this.r,this.g,this.b,this.a)},t.exports=o},function(t,e,i){"use strict";function o(){this.origin={x:0,y:0},this.groundColor="#75f363",this.skyColor="#3251aa",this.minSpawnDist=100,this.maxSpawnDist=200,this.spawnTime=0,this.spawnTimeout=200,this.nonPlayers=[],this.enemies=[],this.shots=[],this.hits=0,this.hitLimit=5,this.playerSpeed=.03,this.enemySpeed=.01,this.shootSpeed=.08,this.shootTimeout=100,this.callDistance=10,this.callTimeout=4e3,this.hurtDistance=5,this.hurtTimeout=1e3,this.enemyRadius=5,this.mapWidth=200,this.mapHeight=200,this.treeNumber=38,this.initialEnemyNumber=15,this.overlayColor=new p(250,10,10,0),this.overlayFadeSpeed=5e-4,this.mouseButtonDown=!1,this.newTime=0,this.oldTime=0,this.gameTime=0,this.minimap=new u({x:10,y:10},108,108,{x:0,y:0},this.mapWidth,this.mapHeight),this.minimap.fillColor="#75F363",this.player=l({x:100,y:130},Math.PI/2),this.player.blipColor="blue",this.player.viewDistance=120,this.player.speed=20,this.minimap.entitiesAD.push(this.player),this.score=0,this.highScore=0,this.started=!1,this.paused=!1,this.loop=function(){},this.pauseCallback=function(){},this.resumeCallback=function(){},this.requestPointerLock=function(){},this.exitPointerLock=function(){}}var n=i(3),s=i(2),r=i(5),a=i(12),h=i(4),p=i(9),u=i(6),l=i(7);o.prototype.randPos=function(){var t=n.randomInt(this.origin.x,this.mapWidth-1),e=n.randomInt(this.origin.y,this.mapHeight-1);return{x:t,y:e}},o.prototype.addTree=function(t,e,i){var o=new r(t);o.blipColor=e,o.img=this.images.i["tree"+i],this.nonPlayers.push(o),this.minimap.entities.push(o)},o.prototype.addRandomTree=function(){var t=this.randPos(),e="rgb(10,"+n.randomInt(40,80)+",10)",i=n.randomInt(1,4);this.addTree(t,e,i)},o.prototype.addEnemy=function(t,e){var i=new r(t);i.blipColor=e,i.img=this.images.i.bird,this.nonPlayers.push(i),this.enemies.push(i),this.minimap.entities.push(i)},o.prototype.randomEnemyBlipColor=function(){return"rgb("+n.randomInt(150,250)+", 10, 10)"},o.prototype.addRandomEnemy=function(){var t=this.randomEnemyBlipColor(),e=this.randPos();this.addEnemy(e,t)},o.prototype.addShot=function(t,e){var i=new r(t);i.blipColor="yellow",i.direction=e,i.img=this.images.i.ball,this.nonPlayers.push(i),this.shots.push(i),this.minimap.entities.push(i)},o.prototype.render=function(t,e){var i=5*t.height/8,o=t.height/100;e.save(),e.clearRect(0,0,t.width,t.height),e.fillStyle=this.groundColor,e.fillRect(0,t.height-i,t.width,i),this.nonPlayers.sort(function(t,e){var i=s.distance(this.player.pos,t.pos),o=s.distance(this.player.pos,e.pos);return o-i}.bind(this)),a.prototype.drawEntities(e,t.width,t.height,i,this.player.pos,this.player.direction,this.player.fieldOfView,this.player.viewDistance,this.nonPlayers,o),this.minimap.draw(e),e.fillStyle=this.overlayColor.toString(!1),e.fillRect(0,0,t.width,t.height),e.restore()},o.prototype.startGame=function(){this.shots=[],this.enemies=[],this.nonPlayers=[],this.hits=0,this.score=0,this.shootSoundIndex=0,this.overlayColor.a=0,this.minimap=new u({x:10,y:10},108,108,{x:0,y:0},this.mapWidth,this.mapHeight),this.minimap.fillColor="#75F363",this.player=l({x:100,y:130},Math.PI/2),this.player.blipColor="blue",this.player.viewDistance=120,this.player.speed=this.playerSpeed,this.minimap.entitiesAD.push(this.player);var t=.2*this.c.width;this.minimap.resize(t,t),this.fpMouseWrapper=this.fpMouse.bind(this),this.mousedownWrapper=this.mousedown.bind(this),this.mouseupWrapper=this.mouseup.bind(this);for(var e=0;e<this.treeNumber;e++)this.addRandomTree();for(var e=0;e<this.initialEnemyNumber;e++){var i=s.randomPointAround(this.player.pos,0,2*Math.PI,100,250),o=this.randomEnemyBlipColor();this.addEnemy(i,o)}this.bindControls=function(){document.addEventListener("keydown",h.keydown),document.addEventListener("keyup",h.keyup),document.addEventListener("mousemove",this.fpMouseWrapper),document.addEventListener("mousedown",this.mousedownWrapper),document.addEventListener("mouseup",this.mouseupWrapper)},this.unbindControls=function(){document.removeEventListener("keydown",h.keydown),document.removeEventListener("keyup",h.keyup),document.removeEventListener("mousemove",this.fpMouseWrapper),document.removeEventListener("mousedown",this.mousedownWrapper),document.removeEventListener("mouseup",this.mouseupWrapper)},this.bindControls(),this.oldTime=(new Date).getTime(),this.started=!0,this.paused=!1,this.looping=!0,this.requestPointerLock(),this.loop()},o.prototype.pause=function(){this.looping=!1,this.paused=!0,this.exitPointerLock(),this.unbindControls(),h.keyDownMap={},this.mouseButtonDown=!1,this.pauseCallback()},o.prototype.resume=function(){this.looping=!0,this.paused=!1,this.resumeCallback(),this.bindControls(),this.oldTime=(new Date).getTime(),this.requestPointerLock(),this.loop()},o.prototype.endGameCleanUp=function(){this.looping=!1,this.started=!1,this.paused=!1,this.exitPointerLock(),this.unbindControls(),h.keyDownMap={},this.mouseButtonDown=!1},o.prototype.tryShoot=function(){var t=(new Date).getTime()-this.shootTime;(void 0===this.shootTime||t>this.shootTimeout)&&s.insideRect(this.player.pos,this.origin,this.mapWidth,this.mapHeight)&&(this.addShot(this.player.pos,this.player.direction),this.audio.howls.shoot.play(),this.shootTime=(new Date).getTime())},o.prototype.mousedown=function(){this.mouseButtonDown=!0},o.prototype.mouseup=function(){this.mouseButtonDown=!1},o.prototype.fpMouse=function(t){var e=t.movementX||t.mozMovementX||0,i=e*h.mouseSens*-1;this.player.direction+=i},t.exports=o},function(t,e){"use strict";function i(){this.i={},this.setupDone=!1,this.totalNumImages=0,this.numImagesLoaded=0}i.prototype.load=function(t,e){this.totalNumImages+=1,this.i[e]=new Image,this.i[e].src=t,this.i[e].onload=function(){console.log("image loaded"),this.numImagesLoaded+=1}.bind(this)},i.prototype.doneLoading=function(){return this.setupDone===!0&&this.numImagesLoaded===this.totalNumImages?!0:!1},t.exports=i},function(t,e,i){"use strict";function o(t,e,i,o,n){this.width=t,this.height=e,this.fieldOfView=i,this.horizonDistance=o,this.fgHeight=n,this.entities=[],this.entityScale=1}var n=i(2);o.prototype.viewTriangleVertices=function(t,e,i,o){var n=[];n.push(t);var s=Math.PI/2-i/2,r=o/Math.sin(s),a=e-i/2,h=e+i/2,p=r*Math.cos(h),u=r*Math.sin(h),l=r*Math.cos(a),d=r*Math.sin(a),c={};c.x=t.x+p,c.y=t.y-u;var m={};return m.x=t.x+l,m.y=t.y-d,n.push(c),n.push(m),n},o.prototype.pointInsideTriangle=function(t,e,i,o){var n=.5*(-i.y*o.x+e.y*(-i.x+o.x)+e.x*(i.y-o.y)+i.x*o.y),s=1/(2*n)*(e.y*o.x-e.x*o.y+(o.y-e.y)*t.x+(e.x-o.x)*t.y),r=1/(2*n)*(e.x*i.y-e.y*i.x+(e.y-i.y)*t.x+(i.x-e.x)*t.y);return s>0&&r>0&&1-s-r>0?!0:!1},o.prototype.normalizeAngle=function(t){var e=t%(2*Math.PI);return e=(e+2*Math.PI)%(2*Math.PI),e>Math.PI&&(e-=2*Math.PI),e},o.prototype.getPerpPoint=function(t,e,i){var n={},s=o.prototype.normalizeAngle(e);if(s==Math.PI/2||s==3*Math.PI/4)n.x=t.x,n.y=i.y;else{var r=Math.tan(e);r=-r,n.x=(r*r*t.x-r*t.y+i.x+r*i.y)/(r*r+1),n.y=r*(n.x-t.x)+t.y}return n},o.prototype.drawEntities=function(t,e,i,n,s,r,a,h,p,u){for(var l=0;l<p.length;l++)o.prototype.drawEntity(t,e,i,n,s,r,a,h,p[l],u)},o.prototype.renderEntity=function(t,e,i,o,n,s,r){t.save(),t.translate(i-s/2,o-r),t.scale(n,n),t.drawImage(e,0,0),t.restore()},o.prototype.drawEntity=function(t,e,i,s,r,a,h,p,u,l){var d=o.prototype.viewTriangleVertices(r,a,h,p);if(o.prototype.pointInsideTriangle(u.pos,d[0],d[1],d[2])){var c=o.prototype.getPerpPoint(r,a,u.pos),m=n.distance(r,c),y=n.distance(u.pos,c),f=m*Math.sin(h/2)/Math.sin((Math.PI-h)/2),g=m/p,v=Math.pow(g,.2),w=y/f,x=w*(e/2),b=i-v*s,M=Math.atan2(r.y-u.pos.y,u.pos.x-r.x),S=o.prototype.normalizeAngle(a),E=o.prototype.normalizeAngle(M),P=Math.cos(S)*Math.sin(E)-Math.sin(S)*Math.cos(E),T=e/2;0>P?T+=x:T-=x;var k=l*u.imgScale*(1-v),C=u.img.width*k,L=u.img.height*k;o.prototype.renderEntity(t,u.img,T,b,k,C,L)}},t.exports=o}]);